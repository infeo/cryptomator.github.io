"use strict";const STRIPE_PK='pk_live_eSasX216vGvC26GdbVwA011V',STRIPE_PLANS={EUR:'plan_GgW4ovr7c6upzx',USD:'plan_HYOXl2Z3uV5TwB'},STRIPE_PHP_URL='https://api.cryptomator.org/stripe/prepare_payment.php';class OneTimePayment{constructor(a){this._status=a}initStripeField(a,c,d){let b=document.createElement('div');$(b).hide(),$(a).after(b),$(a).attr('placeholder',c),$(a).attr('disabled',!0),this._stripe=$.ajax({url:'https://js.stripe.com/v3/',cache:!0,dataType:'script'}).then(a=>window.Stripe(STRIPE_PK)),this._card=this._stripe.then(e=>{let c=e.elements({locale:d}).create('card',{style:{base:{fontFamily:'Open Sans, sans-serif',fontSize:'16px',lineHeight:'1.5'}}});return c.mount(b),c.on('ready',d=>{$(b).show(),$(a).hide(),c.focus()}),c.on('change',this.onCardChanged.bind(this)),c})}onCardChanged(a){this._status.validCardNum=a.complete,a.error?this._status.errorMessage=a.error.message:this._status.errorMessage=''}charge(a,b){this._status.inProgress=!0,this._status.errorMessage='',this._status.success=!1;let c=$.ajax({url:STRIPE_PHP_URL,type:'POST',data:{currency:b,amount:a,captcha:this._status.captcha}});Promise.all([this._stripe,this._card,c]).then(([a,b,c])=>{a.confirmCardPayment(c.client_secret,{payment_method:{card:b}}).then(function(a){a.error?this.onPaymentFailed(a.error):a.paymentIntent.status==='succeeded'&&this.onPaymentSucceeded()}.bind(this))})}onPaymentFailed(a){console.warn('Stripe payment failed with error',a),this._status.success=!1,this._status.errorMessage=a.message,this._status.inProgress=!1,grecaptcha&&(this._status.captcha='',grecaptcha.reset())}onPaymentSucceeded(){console.info('Stripe payment succeeded!'),this._status.success=!0,this._status.errorMessage='',this._status.inProgress=!1,grecaptcha&&(this._status.captcha='',grecaptcha.reset())}}class RecurringPayment{checkout(a,b,c){let d=STRIPE_PLANS[b];$.ajax({url:'https://js.stripe.com/v3/',cache:!0,dataType:'script'}).then(a=>window.Stripe(STRIPE_PK)).then(b=>{b.redirectToCheckout({items:[{plan:d,quantity:parseInt(a)}],successUrl:window.location.href.split('#')[0]+'thanks',cancelUrl:window.location.href,locale:c}).then(a=>{a.error&&console.log(a.error.message)})})}}