"use strict";const PADDLE_ENABLE_SANDBOX=!1,PADDLE_VENDOR_ID=39223,GENERATE_PAY_LINK_URL='https://store.cryptomator.org/api/desktop/generate-pay-link';class DesktopLicense{constructor(a,b){this._form=a,this._checkoutData=b,this._paddle=$.ajax({url:'https://cdn.paddle.com/paddle/paddle.js',cache:!0,dataType:'script'}).then(()=>(PADDLE_ENABLE_SANDBOX&&window.Paddle.Environment.set('sandbox'),window.Paddle.Setup({vendor:PADDLE_VENDOR_ID}),window.Paddle))}checkout(a){if(!$(this._form)[0].checkValidity()){$(this._form).find(':input').addClass('show-invalid');return}this._checkoutData.inProgress=!0,this._checkoutData.errorMessage='',this._checkoutData.success=!1,$.ajax({url:GENERATE_PAY_LINK_URL,type:'POST',data:{currency:this._checkoutData.currency,amount:this._checkoutData.amount,quantity:this._checkoutData.quantity}}).done(b=>{this.openPaddleCheckout(b.pay_link,a)}).fail(a=>{this.onCheckoutFailed(a.responseJSON?.message||'Generating pay link failed.')})}openPaddleCheckout(a,b){this._paddle.then(c=>{c.Checkout.open({override:a,email:this._checkoutData.email,locale:b,successCallback:a=>{this.onCheckoutSucceeded(),this.getPaddleOrderDetails(a.checkout.id)},closeCallback:()=>{this._checkoutData.inProgress=!1}})})}getPaddleOrderDetails(a){this._paddle.then(b=>{b.Order.details(a,b=>{let a=b.lockers?.[0]?.license_code;a?this._checkoutData.licenseKey=a:this._checkoutData.errorMessage='Retrieving supporter certificate failed. Please check your emails instead.'})})}onCheckoutFailed(a){this._checkoutData.success=!1,this._checkoutData.errorMessage=a,this._checkoutData.inProgress=!1}onCheckoutSucceeded(){this._checkoutData.success=!0,this._checkoutData.errorMessage='',this._checkoutData.inProgress=!1}}